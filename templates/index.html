<!doctype html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AlgoNode - å¯è§†åŒ–æ•°å­¦å»ºæ¨¡</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litegraph.js/css/litegraph.css" />
  <link rel="stylesheet" href="/static/css/style.css" />
  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">
  <style>
    .CodeMirror {
      height: 100%;
      font-size: 14px;
    }
    #codeModal .CodeMirror {
      height: 400px;
    }
    .tab-btn.active {
        color: #4CAF50 !important;
        border-bottom: 2px solid #4CAF50 !important;
    }
    .market-item {
        background: #222;
        border: 1px solid #444;
        border-radius: 6px;
        padding: 15px;
        display: flex;
        flex-direction: column;
    }
    .market-item h4 { margin: 0 0 5px 0; color: #4CAF50; }
    .market-item .meta { font-size: 12px; color: #888; margin-bottom: 10px; }
    .market-item .desc { font-size: 13px; color: #ccc; flex: 1; margin-bottom: 15px; }
    .market-item button { width: 100%; padding: 5px; cursor: pointer; background: #333; color: #eee; border: 1px solid #555; }
    .market-item button:hover { background: #444; }
    .market-item .type-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 11px;
        margin-right: 5px;
    }
    .type-badge.project { background: #2196F3; color: white; }
    .type-badge.subgraph { background: #4CAF50; color: white; }
    .type-badge.node { background: #FF9800; color: white; }
    .filter-btn {
        background: #333;
        border: 1px solid #555;
        color: #aaa;
        padding: 5px 12px;
        border-radius: 15px;
        cursor: pointer;
        font-size: 13px;
    }
    .filter-btn:hover { background: #444; }
    .filter-btn.active { background: #4CAF50; color: white; border-color: #4CAF50; }
    .source-badge {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 10px;
        margin-left: 5px;
    }
    .source-badge.local { background: #666; color: #ddd; }
    .source-badge.remote { background: #2196F3; color: white; }
    #centralServerInfo {
        padding: 8px 12px;
        background: #1a3a1a;
        border: 1px solid #4CAF50;
        border-radius: 4px;
        margin-bottom: 10px;
        font-size: 12px;
        color: #8f8;
    }
    #centralServerInfo.disconnected {
        background: #3a1a1a;
        border-color: #f44336;
        color: #f88;
    }
    /* Toast Notifications */
    #toast-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 2000;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .toast {
        background: #333;
        color: #fff;
        padding: 12px 20px;
        border-radius: 4px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        border-left: 4px solid #4CAF50;
        animation: slideIn 0.3s ease-out forwards;
        min-width: 200px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .toast.info { border-left-color: #2196F3; }
    .toast.warning { border-left-color: #FF9800; }
    .toast.error { border-left-color: #f44336; }
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="toast-container"></div>
  <div class="app">
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>èŠ‚ç‚¹åº“</h2>
        <input type="text" id="nodeSearch" class="search-box" placeholder="æœç´¢èŠ‚ç‚¹..." />
      </div>
      <div id="nodeList" class="node-list">
        <!-- Categories and nodes will be rendered here by JS -->
      </div>
      <div class="category" style="margin-top: 10px; flex-shrink: 0;">
        <div class="category-header" onclick="this.parentElement.classList.toggle('collapsed')">
          ğŸ”§ å·¥å…·ç®±
        </div>
        <div class="category-content actions" style="border-top: none; padding: 5px;">
          <button id="btnRun" class="primary-btn">è¿è¡Œæ¨¡å‹</button>
          <button id="btnExport">å¯¼å‡º Python ä»£ç </button>
          <button id="btnSaveLocal">ä¿å­˜åˆ°æœ¬åœ°</button>
          <button id="btnLoadLocal">æ‰“å¼€æœ¬åœ°æ–‡ä»¶</button>
          <input type="file" id="fileInput" style="display: none;" accept=".json" />
          <button id="btnSample">è½½å…¥ç¤ºä¾‹</button>
          <button id="btnMarket" style="margin-top: 10px; background: #FF9800;">èŠ‚ç‚¹å¸‚åœº</button>
          <button id="btnDataManager" style="margin-top: 5px; background: #009688;">ğŸ“‚ æ•°æ®ç®¡ç†</button>
          <button id="btnPublish" style="margin-top: 5px; background: #9C27B0;">å‘å¸ƒä½œå“</button>
          <button id="btnAbout" style="margin-top: 10px; background: #2a3a5a;">å…³äº AlgoNode</button>
        </div>
      </div>
    </div>
    <div class="canvas-wrap">
      <canvas id="graphcanvas" width="1200" height="800"></canvas>
      <div id="status-bar">Ready</div>
    </div>
  </div>

  <!-- Run Result Modal -->
  <div id="resultModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>è¿è¡Œç»“æœ</h3>
        <span class="close">&times;</span>
      </div>
      <pre id="runOutput"></pre>
    </div>
  </div>

  <div id="codeModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>å¯¼å‡ºçš„ Python ä»£ç </h3>
        <button id="closeModal">å…³é—­</button>
      </div>
      <textarea id="codeOutput" readonly></textarea>
      <div class="modal-actions">
        <button id="downloadPy">ä¸‹è½½ä¸º .py</button>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <div id="aboutModal" class="modal hidden">
    <div class="modal-content" style="width: 500px; height: auto; text-align: center;">
      <div class="modal-header">
        <h3>å…³äº AlgoNode</h3>
        <span class="close" id="closeAbout">&times;</span>
      </div>
      <div style="padding: 20px;">
        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ§®</div>
        <h2 style="margin: 0 0 10px 0; color: #4CAF50;">AlgoNode</h2>
        <p style="color: #aaa; margin-bottom: 20px;">å¯è§†åŒ–æ•°å­¦å»ºæ¨¡å¹³å°</p>
        <div style="text-align: left; background: #2a2a2a; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <p style="margin: 8px 0;"><strong>ç‰ˆæœ¬ï¼š</strong>v0.5.1</p>
          <p style="margin: 8px 0;"><strong>ä½œè€…ï¼š</strong>ç”µå­ç§‘æŠ€å¤§å­¦ é—»å®¶è´¤</p>
          <p style="margin: 8px 0;"><strong>å¼€æºä»“åº“ï¼š</strong><a href="https://github.com/streetartist/algonode" target="_blank" style="color: #4CAF50;">github.com/streetartist/algonode</a></p>
        </div>
        <div style="font-style: italic; color: #888; border-left: 3px solid #4CAF50; padding-left: 15px; text-align: left;">
          "The purpose of abstraction is not to be vague, but to create a new semantic level in which one can be absolutely precise."<br>
          <span style="color: #666;">â€” Edsger W. Dijkstra</span>
        </div>
        <p style="margin-top: 20px; font-size: 0.85rem; color: #666;">å°†å¤æ‚çš„ç®—æ³•æŠ½è±¡ä¸ºå¯è¿æ¥çš„èŠ‚ç‚¹ï¼Œè®©å»ºæ¨¡å˜å¾—ç®€å•è€Œç²¾ç¡®ã€‚</p>
      </div>
    </div>
  </div>

  <!-- Market Browse Modal -->
  <div id="marketModal" class="modal hidden">
    <div class="modal-content" style="width: 800px; height: 600px; display: flex; flex-direction: column;">
      <div class="modal-header">
        <h3>èŠ‚ç‚¹å¸‚åœº</h3>
        <span class="close" id="closeMarket">&times;</span>
      </div>
      <div id="centralServerInfo" class="hidden"></div>
      <div class="market-filter" style="display: flex; gap: 10px; margin-bottom: 15px;">
        <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
        <button class="filter-btn" data-filter="project">å®Œæ•´é¡¹ç›®</button>
        <button class="filter-btn" data-filter="subgraph">å­å›¾</button>
        <button class="filter-btn" data-filter="node">è‡ªå®šä¹‰èŠ‚ç‚¹</button>
      </div>
      <div id="marketBrowse" style="flex: 1; overflow-y: auto;">
        <div id="marketList" class="market-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px;">
            <div style="text-align: center; padding: 20px; color: #888;">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Market Upload Modal -->
  <div id="uploadModal" class="modal hidden">
    <div class="modal-content" style="width: 500px; height: auto;">
      <div class="modal-header">
        <h3>å‘å¸ƒåˆ°å¸‚åœº</h3>
        <span class="close" id="closeUpload">&times;</span>
      </div>
      <div style="padding: 10px 0;">
        <div class="form-group" style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px;">åç§°</label>
            <input type="text" id="uploadName" class="full-width" placeholder="ç»™ä½ çš„ä½œå“èµ·ä¸ªåå­—" style="width: 100%; padding: 8px; background: #222; border: 1px solid #444; color: #eee;">
        </div>
        <div class="form-group" style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px;">ç±»å‹</label>
            <select id="uploadType" class="full-width" style="width: 100%; padding: 8px; background: #222; border: 1px solid #444; color: #eee;">
                <option value="project">å®Œæ•´ç¨‹åº (å½“å‰ç”»å¸ƒ)</option>
                <option value="subgraph">å­å›¾ (å½“å‰é€‰ä¸­çš„å­å›¾èŠ‚ç‚¹)</option>
                <option value="node">è‡ªå®šä¹‰èŠ‚ç‚¹ (å½“å‰é€‰ä¸­çš„èŠ‚ç‚¹)</option>
            </select>
            <p id="uploadTypeHint" class="hint" style="font-size: 12px; color: #aaa; margin-top: 5px;">
                ä¸Šä¼ å½“å‰ç”»å¸ƒçš„æ‰€æœ‰å†…å®¹ä½œä¸ºå®Œæ•´é¡¹ç›®ã€‚
            </p>
        </div>
        <div class="form-group" style="margin-bottom: 15px;" id="uploadTargetGroup">
            <label style="display: block; margin-bottom: 5px;">å‘å¸ƒç›®æ ‡</label>
            <select id="uploadTarget" class="full-width" style="width: 100%; padding: 8px; background: #222; border: 1px solid #444; color: #eee;">
                <option value="local">æœ¬åœ°å¸‚åœº</option>
                <option value="remote">ä¸­å¤®æœåŠ¡å™¨</option>
            </select>
            <p class="hint" style="font-size: 12px; color: #aaa; margin-top: 5px;">
                æœ¬åœ°å¸‚åœºä»…æœ¬æœºå¯è§ï¼Œä¸­å¤®æœåŠ¡å™¨å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§ã€‚
            </p>
        </div>
        <div class="form-group" style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px;">ä½œè€…</label>
            <input type="text" id="uploadAuthor" class="full-width" placeholder="ä½ çš„åå­—" style="width: 100%; padding: 8px; background: #222; border: 1px solid #444; color: #eee;">
        </div>
        <div class="form-group" style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px;">æè¿°</label>
            <textarea id="uploadDesc" class="full-width" rows="4" placeholder="ä»‹ç»ä¸€ä¸‹è¿™ä¸ªä½œå“çš„åŠŸèƒ½..." style="width: 100%; padding: 8px; background: #222; border: 1px solid #444; color: #eee;"></textarea>
        </div>
        <button id="btnDoUpload" class="primary-btn" style="margin-top: 10px; width: 100%; padding: 10px;">ç¡®è®¤å‘å¸ƒ</button>
      </div>
    </div>
  </div>

  <!-- Data Manager Modal -->
  <div id="dataModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>æ•°æ®æ–‡ä»¶ç®¡ç†</h3>
        <span class="close" id="closeDataModal">&times;</span>
      </div>
      <div style="margin-bottom: 15px; padding: 15px; background: #222; border-radius: 4px; border: 1px solid #444;">
          <input type="file" id="dataFileUpload" style="display: none;">
          <button id="btnSelectFile" class="primary-btn">ğŸ“¤ ä¸Šä¼ æ–°æ–‡ä»¶</button>
          <span id="uploadStatus" style="margin-left: 10px; color: #aaa; font-size: 13px;">æ”¯æŒ CSV, Excel ç­‰æ ¼å¼</span>
      </div>
      <div id="dataFileList" style="max-height: 400px; overflow-y: auto; border: 1px solid #444; border-radius: 4px;">
          <!-- File items will be here -->
          <div style="padding: 20px; text-align: center; color: #666;">åŠ è½½ä¸­...</div>
      </div>
    </div>
  </div>

  <!-- Python Code Editor Modal -->
  <div id="pythonEditModal" class="modal hidden">
    <div class="modal-content" style="width: 90%; max-width: 1000px; height: 80%;">
      <div class="modal-header">
        <h3>ç¼–è¾‘ Python ä»£ç </h3>
        <span class="close" id="closePythonEdit">&times;</span>
      </div>
      <div style="display: flex; flex-direction: column; height: 100%;">
        <textarea id="pythonCodeEditor" style="flex: 1; background: #1e1e1e; color: #d4d4d4; font-family: Consolas, monospace; padding: 10px; border: 1px solid #444; resize: none;"></textarea>
        <div class="modal-actions" style="margin-top: 10px; text-align: right;">
          <button id="btnSavePythonCode" class="primary-btn">ä¿å­˜ä»£ç </button>
          <button id="btnCancelPythonCode">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/litegraph.js/build/litegraph.min.js"></script>
  <!-- CodeMirror JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
  <script src="/static/js/app.js"></script>
</body>
</html>
