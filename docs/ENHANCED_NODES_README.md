# ğŸ‰ AlgoNode å¢å¼ºèŠ‚ç‚¹ - ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸º AlgoNode æ–°å¢äº† **4 ä¸ªæ ¸å¿ƒæ•°æ®å¤„ç†èŠ‚ç‚¹**ï¼Œå¯ä»¥è®©æ‚¨åœ¨**ä¸ç¼–å†™ä»»ä½•ä»£ç **çš„æƒ…å†µä¸‹å®Œæˆå¤æ‚çš„ç‰¹å¾å·¥ç¨‹å’Œæ•°æ®è½¬æ¢ã€‚

### æ–°å¢èŠ‚ç‚¹ä¸€è§ˆ

| ğŸ¯ èŠ‚ç‚¹åç§° | ğŸ“ åŠŸèƒ½æè¿° | ğŸ”§ å…¸å‹ç”¨é€” |
|-----------|------------|-----------|
| **Rolling Window** | æ»šåŠ¨çª—å£ç»Ÿè®¡ | ç§»åŠ¨å¹³å‡ã€æ»šåŠ¨æ±‚å’Œã€è¶‹åŠ¿å¹³æ»‘ |
| **Transform Column** | åˆ—å˜æ¢æ“ä½œ | å·®åˆ†ã€å¯¹æ•°ã€ç´¯è®¡ã€å¡«å……ç¼ºå¤±å€¼ |
| **Merge DataFrames** | æ•°æ®æ¡†åˆå¹¶ | å·¦è¿æ¥ã€å†…è¿æ¥ã€æ•°æ®æ•´åˆ |
| **Time Features** | æ—¶é—´ç‰¹å¾æå– | å¹´æœˆæ—¥ã€æ˜ŸæœŸã€å­£åº¦æå– |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ‰“å¼€èŠ‚ç‚¹åº“
åœ¨ AlgoNode ç•Œé¢ä¸­ï¼Œç‚¹å‡»å·¦ä¾§ **"èŠ‚ç‚¹åº“"** æŒ‰é’®

### 2. æœç´¢æ–°èŠ‚ç‚¹
åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯ï¼š
- `rolling` - æŸ¥æ‰¾æ»šåŠ¨çª—å£èŠ‚ç‚¹
- `transform` - æŸ¥æ‰¾å˜æ¢èŠ‚ç‚¹
- `merge` - æŸ¥æ‰¾åˆå¹¶èŠ‚ç‚¹
- `time` - æŸ¥æ‰¾æ—¶é—´ç‰¹å¾èŠ‚ç‚¹

### 3. æ‹–æ‹½ä½¿ç”¨
å°†èŠ‚ç‚¹æ‹–å…¥ç”»å¸ƒï¼Œè¿æ¥æ•°æ®æµï¼Œé…ç½®å‚æ•°

### 4. è¿è¡ŒéªŒè¯
ç‚¹å‡» **"è¿è¡Œæ¨¡å‹"** æˆ– **"å¯¼å‡º Python ä»£ç "** æŸ¥çœ‹æ•ˆæœ

---

## ğŸ“– èŠ‚ç‚¹è¯¦è§£

### 1ï¸âƒ£ Rolling Window - æ»šåŠ¨çª—å£ç»Ÿè®¡

**ç”¨é€”**: è®¡ç®—ç§»åŠ¨å¹³å‡ã€æ»‘åŠ¨æ±‚å’Œç­‰æ—¶é—´çª—å£ç»Ÿè®¡é‡

**å‚æ•°è¯´æ˜**:

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `column` | è¦å¤„ç†çš„åˆ—å | `"Gold"` |
| `window` | çª—å£å¤§å° | `3` (æœ€è¿‘3ä¸ªå‘¨æœŸ) |
| `operation` | æ“ä½œç±»å‹ | `mean` / `sum` / `std` / `min` / `max` |
| `groupby` | åˆ†ç»„åˆ— | `"NOC"` (æŒ‰å›½å®¶åˆ†ç»„) |
| `min_periods` | æœ€å°æœ‰æ•ˆæœŸæ•° | `1` |
| `output_column` | è¾“å‡ºåˆ—å | `"gold_avg_3"` |

**ä½¿ç”¨ç¤ºä¾‹**:
```
è®¡ç®—æ¯ä¸ªå›½å®¶æœ€è¿‘3å±Šå¥¥è¿ä¼šçš„å¹³å‡é‡‘ç‰Œæ•°
- column: "Gold"
- window: 3
- operation: "mean"
- groupby: "NOC"
- output_column: "gold_avg_3"
```

**ç”Ÿæˆä»£ç **:
```python
medals["gold_avg_3"] = medals.groupby("NOC")["Gold"] \
    .rolling(3, min_periods=1).mean() \
    .reset_index(level=0, drop=True)
```

---

### 2ï¸âƒ£ Transform Column - åˆ—å˜æ¢

**ç”¨é€”**: å¯¹å•åˆ—è¿›è¡Œæ•°å­¦æˆ–ç»Ÿè®¡å˜æ¢

**æ”¯æŒçš„æ“ä½œç±»å‹**:

| æ“ä½œ | è¯´æ˜ | ç”¨é€” |
|-----|------|------|
| `diff` | å·®åˆ† | è®¡ç®—å˜åŒ–é‡ (åŠ¨é‡) |
| `pct_change` | ç™¾åˆ†æ¯”å˜åŒ– | è®¡ç®—å¢é•¿ç‡ |
| `shift` | æ»å/è¶…å‰ | æ—¶é—´åºåˆ—åç§» |
| `cumsum` | ç´¯è®¡æ±‚å’Œ | ç´¯ç§¯ç»Ÿè®¡ |
| `log` | å¯¹æ•°å˜æ¢ | å¤„ç†åæ€åˆ†å¸ƒ |
| `sqrt` | å¹³æ–¹æ ¹ | ç¨³å®šæ–¹å·® |
| `abs` | ç»å¯¹å€¼ | æ¶ˆé™¤è´Ÿå€¼ |
| `fillna` | å¡«å……ç¼ºå¤±å€¼ | æ•°æ®æ¸…æ´— |
| `round` | å››èˆäº”å…¥ | ç²¾åº¦æ§åˆ¶ |

**ä½¿ç”¨ç¤ºä¾‹ 1: è®¡ç®—é‡‘ç‰Œå¢é•¿åŠ¨é‡**
```
- column: "Gold"
- operation: "diff"
- periods: 1
- output_column: "gold_momentum"
```

**ä½¿ç”¨ç¤ºä¾‹ 2: å¡«å……ç¼ºå¤±å€¼**
```
- column: "gold_momentum"
- operation: "fillna"
- fill_value: 0
- output_column: "gold_momentum"
```

---

### 3ï¸âƒ£ Merge DataFrames - æ•°æ®åˆå¹¶

**ç”¨é€”**: åƒ SQL ä¸€æ ·åˆå¹¶ä¸¤ä¸ªæ•°æ®è¡¨

**å‚æ•°è¯´æ˜**:

| å‚æ•° | è¯´æ˜ | å¯é€‰å€¼ |
|-----|------|--------|
| `how` | è¿æ¥æ–¹å¼ | `inner` / `left` / `right` / `outer` |
| `on` | å…±åŒé”®åˆ— | `"Year"` |
| `left_on` | å·¦è¡¨é”®åˆ— | `"Year"` |
| `right_on` | å³è¡¨é”®åˆ— | `"year"` |

**ä½¿ç”¨ç¤ºä¾‹**:
```
åˆå¹¶å¥–ç‰Œæ•°æ®å’Œä¸»åŠå›½æ•°æ®
- how: "left"
- on: "Year"
```

**ç”Ÿæˆä»£ç **:
```python
merged = pd.merge(medals, hosts, on="Year", how="left")
```

---

### 4ï¸âƒ£ Time Features - æ—¶é—´ç‰¹å¾æå–

**ç”¨é€”**: ä»æ—¥æœŸåˆ—è‡ªåŠ¨æå–æ—¶é—´ç»´åº¦ç‰¹å¾

**æ”¯æŒçš„ç‰¹å¾**:

| ç‰¹å¾ | è¯´æ˜ | è¾“å‡ºåˆ— |
|-----|------|--------|
| `year` | å¹´ä»½ | `year` |
| `month` | æœˆä»½ (1-12) | `month` |
| `day` | æ—¥æœŸ (1-31) | `day` |
| `dayofweek` | æ˜ŸæœŸå‡  (0-6) | `dayofweek` |
| `quarter` | å­£åº¦ (1-4) | `quarter` |
| `dayofyear` | ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤© | `dayofyear` |
| `weekofyear` | ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨ | `weekofyear` |

**ä½¿ç”¨ç¤ºä¾‹**:
```
æå–å¹´ä»½ç‰¹å¾
- date_column: "Year"
- features: "year"
```

**ç”Ÿæˆä»£ç **:
```python
medals["year"] = pd.to_datetime(medals["Year"]).dt.year
```

---

## ğŸ¯ å®Œæ•´æ¡ˆä¾‹ï¼šMCM Problem C ç‰¹å¾å·¥ç¨‹

### åœºæ™¯æè¿°
éœ€è¦ä»å†å²å¥¥è¿å¥–ç‰Œæ•°æ®ä¸­æå–ä»¥ä¸‹ç‰¹å¾ï¼š
1. æœ€è¿‘ 3 å±Šå’Œ 5 å±Šçš„å¹³å‡é‡‘ç‰Œæ•°
2. é‡‘ç‰Œå¢é•¿åŠ¨é‡ï¼ˆä¸€é˜¶å·®åˆ†ï¼‰
3. åˆå¹¶ä¸»åŠå›½ä¿¡æ¯
4. æå–å¹´ä»½ç‰¹å¾

### ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆéœ€è¦ 80+ è¡Œä»£ç ï¼‰
```python
# éœ€è¦ç¼–å†™å¤§é‡ pandas ä»£ç ...
medals["gold_avg_3"] = medals.groupby("NOC")["Gold"] \
    .rolling(3, min_periods=1).mean() \
    .reset_index(level=0, drop=True)
# ... çœç•¥ 70+ è¡Œ
```

### æ–°æ–¹æ¡ˆï¼ˆ0 è¡Œä»£ç ï¼Œçº¯æ‹–æ‹½ï¼‰

**å·¥ä½œæµç»“æ„**:
```
1. Load CSV (medals)
   â†“
2. Filter Rows (Year >= 1988)
   â†“
3. Rolling Window (gold_avg_3, groupby=NOC)
   â†“
4. Rolling Window (gold_avg_5, groupby=NOC)
   â†“
5. Transform Column (diff â†’ gold_momentum)
   â†“
6. Transform Column (fillna 0)
   â†“
7. Load CSV (hosts)
   â†“
8. Merge DataFrames (on=Year)
   â†“
9. Time Features (extract year)
   â†“
10. Output (processed_data)
```

**åŠ è½½ç¤ºä¾‹æ–‡ä»¶**:
```
æ–‡ä»¶ä½ç½®: examples/enhanced_nodes_demo.json
åœ¨ AlgoNode ä¸­: æ‰“å¼€æœ¬åœ°æ–‡ä»¶ â†’ é€‰æ‹©è¯¥ JSON
```

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### æŠ€å·§ 1: é“¾å¼å˜æ¢
å¤šä¸ª Transform Column èŠ‚ç‚¹å¯ä»¥ä¸²è”ä½¿ç”¨ï¼š
```
åŸå§‹æ•°æ® â†’ diff â†’ fillna â†’ log â†’ æœ€ç»ˆç»“æœ
```

### æŠ€å·§ 2: åˆ†ç»„æ“ä½œ
Rolling Window å’Œéƒ¨åˆ† Transform æ”¯æŒ `groupby` å‚æ•°ï¼š
```
groupby="NOC"  # æŒ‰å›½å®¶åˆ†ç»„è®¡ç®—
groupby="Year,NOC"  # å¤šåˆ—åˆ†ç»„
```

### æŠ€å·§ 3: è¾“å‡ºåˆ—å‘½å
å»ºè®®æ˜ç¡®æŒ‡å®š `output_column`ï¼Œé¿å…åˆ—åå†²çªï¼š
```
output_column="gold_avg_3"  # æ¸…æ™°çš„å‘½å
output_column="Gold_mean_3"  # ä¹Ÿå¯ä»¥
```

### æŠ€å·§ 4: è°ƒè¯•æŠ€å·§
åœ¨å…³é”®èŠ‚ç‚¹åæ·»åŠ  `io/output` æŸ¥çœ‹ä¸­é—´ç»“æœï¼š
```
Rolling Window â†’ Output (æ£€æŸ¥ç‚¹1) â†’ Transform â†’ Output (æ£€æŸ¥ç‚¹2)
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ‰¾ä¸åˆ°åˆ—å
**é”™è¯¯**: `KeyError: 'Gold'`

**è§£å†³**:
1. æ£€æŸ¥ä¸Šæ¸¸èŠ‚ç‚¹çš„ `output_format` æ˜¯å¦ä¸º `"dataframe"`
2. ç¡®è®¤åˆ—åæ‹¼å†™æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
3. åœ¨èŠ‚ç‚¹å‰æ·»åŠ  Output æŸ¥çœ‹å®é™…åˆ—å

### é—®é¢˜ 2: åˆ†ç»„ååˆ—æ¶ˆå¤±
**é”™è¯¯**: Rolling Window ååˆ—å˜æˆ NaN

**è§£å†³**:
1. æ£€æŸ¥ `groupby` å‚æ•°æ‹¼å†™
2. ç¡®è®¤åˆ†ç»„åˆ—å­˜åœ¨äºæ•°æ®ä¸­
3. è®¾ç½® `min_periods=1` é¿å…é¦–è¡Œ NaN

### é—®é¢˜ 3: åˆå¹¶åæ•°æ®ä¸¢å¤±
**é”™è¯¯**: Merge åè¡Œæ•°å˜å°‘

**è§£å†³**:
1. æ£€æŸ¥ `how` å‚æ•°ï¼š
   - `inner` - åªä¿ç•™åŒ¹é…çš„è¡Œ
   - `left` - ä¿ç•™å·¦è¡¨æ‰€æœ‰è¡Œ
   - `outer` - ä¿ç•™æ‰€æœ‰è¡Œ
2. ç¡®è®¤é”®åˆ—æ•°æ®ç±»å‹ä¸€è‡´

---

## ğŸ“š æ›´å¤šèµ„æº

- **è®¾è®¡æ–‡æ¡£**: `docs/enhanced_nodes_design.md`
- **ä½¿ç”¨æŒ‡å—**: `docs/enhanced_nodes_usage.md`
- **ä¼˜åŒ–æ€»ç»“**: `docs/optimization_summary.md`
- **ç¤ºä¾‹æ–‡ä»¶**: `examples/enhanced_nodes_demo.json`

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### ç«‹å³ä½“éªŒ
1. åˆ·æ–° AlgoNode é¡µé¢
2. æ‰“å¼€èŠ‚ç‚¹åº“æœç´¢æ–°èŠ‚ç‚¹
3. åŠ è½½ç¤ºä¾‹æ–‡ä»¶ `enhanced_nodes_demo.json`
4. è¿è¡Œæ¨¡å‹æŸ¥çœ‹æ•ˆæœ

### æä¾›åé¦ˆ
å¦‚æœæ‚¨æœ‰ä»»ä½•å»ºè®®æˆ–å‘ç° bugï¼Œæ¬¢è¿åé¦ˆï¼

---

**æ›´æ–°æ—¥æœŸ**: 2025-12-03  
**ç‰ˆæœ¬**: v2.0  
**å…¼å®¹æ€§**: âœ… å®Œå…¨å‘åå…¼å®¹
