{
  "last_node_id": 14,
  "last_link_id": 16,
  "nodes": [
    {
      "id": 1,
      "type": "data/load_csv",
      "pos": [50, 100],
      "size": [220, 120],
      "title": "Load Standardized Data",
      "properties": {
        "path": "D:/algonode/user_project/Risk Assessment Based on the Coupling of Public Health Disaster Hazard and Urban Vulnerability/数据标准化.csv",
        "header": 0,
        "encoding": "utf-8",
        "output_format": "dataframe"
      },
      "outputs": [
        {"name": "data", "type": "dataframe", "links": [1]}
      ]
    },
    {
      "id": 2,
      "type": "data/load_csv",
      "pos": [50, 280],
      "size": [220, 120],
      "title": "Load COVID Cases",
      "properties": {
        "path": "D:/algonode/user_project/Risk Assessment Based on the Coupling of Public Health Disaster Hazard and Urban Vulnerability/确诊病例.csv",
        "header": 0,
        "encoding": "utf-8",
        "output_format": "dataframe"
      },
      "outputs": [
        {"name": "data", "type": "dataframe", "links": [2]}
      ]
    },
    {
      "id": 3,
      "type": "data/filter_rows",
      "pos": [320, 100],
      "size": [200, 100],
      "title": "Filter Data Rows",
      "properties": {
        "condition": "index >= 3",
        "reset_index": true,
        "output_format": "dataframe"
      },
      "inputs": [
        {"name": "data", "type": "dataframe", "link": 1}
      ],
      "outputs": [
        {"name": "filtered", "type": "dataframe", "links": [3]}
      ]
    },
    {
      "id": 4,
      "type": "data/select_column",
      "pos": [320, 280],
      "size": [200, 80],
      "title": "Extract COVID Cases",
      "properties": {
        "selector": "新增确诊病例+无症状感染",
        "mode": "name",
        "as_array": true
      },
      "inputs": [
        {"name": "data", "type": "dataframe", "link": 2}
      ],
      "outputs": [
        {"name": "column", "type": "array", "links": [4]}
      ]
    },
    {
      "id": 5,
      "type": "custom/python_script",
      "pos": [570, 100],
      "size": [450, 500],
      "title": "Sensitivity Analysis & Indicator Importance",
      "properties": {
        "code": "import numpy as np\nimport pandas as pd\nfrom scipy import stats\n\n# Define indicators\nhazard_indicators = ['65岁及以上人口比例', '贫困人口', '人口密度', '就业密度', \n                     '国内游客到达人数', '每万人公共汽车（和无轨电车）数量', \n                     '公路客运交通量', 'PM2.5浓度', '相对湿度', '平均温度']\nhazard_types = ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P', 'P', 'N']\n\nvuln_indicators = ['居住密度', '日常生活服务设施密度', '交通设施密度', \n                   '建成区绿化覆盖率', '开放空间密度', '失业率', '人均收入',\n                   '健康支出占GDP的百分比', '每位居民年平均储蓄存款余额',\n                   '应急物资储备支出占GDP的比例（%）（每万元）', \n                   '每万人医生数量', '每万人医院床位数', '基本社会保险覆盖率']\nvuln_types = ['N', 'P', 'P', 'N', 'N', 'P', 'N', 'N', 'N', 'N', 'N', 'N', 'N']\n\n# Normalize COVID cases\ncases = np.array(covid_cases, dtype=float)\ncases_norm = (cases - np.min(cases)) / (np.max(cases) - np.min(cases) + 1e-10)\n\n# Calculate correlation of each indicator with COVID cases\nhazard_corr = []\nhazard_names = []\nfor i, ind in enumerate(hazard_indicators):\n    if ind in data.columns:\n        vals = pd.to_numeric(data[ind], errors='coerce').values\n        vals_norm = (vals - np.min(vals)) / (np.max(vals) - np.min(vals) + 1e-10)\n        if hazard_types[i] == 'N':\n            vals_norm = 1 - vals_norm\n        corr, _ = stats.pearsonr(vals_norm, cases_norm)\n        hazard_corr.append(float(corr))\n        hazard_names.append(ind)\n\nvuln_corr = []\nvuln_names = []\nfor i, ind in enumerate(vuln_indicators):\n    if ind in data.columns:\n        vals = pd.to_numeric(data[ind], errors='coerce').values\n        vals_norm = (vals - np.min(vals)) / (np.max(vals) - np.min(vals) + 1e-10)\n        if vuln_types[i] == 'N':\n            vals_norm = 1 - vals_norm\n        corr, _ = stats.pearsonr(vals_norm, cases_norm)\n        vuln_corr.append(float(corr))\n        vuln_names.append(ind)\n\n# Convert to arrays\nhazard_corr = np.array(hazard_corr)\nvuln_corr = np.array(vuln_corr)\nhazard_names = np.array(hazard_names)\nvuln_names = np.array(vuln_names)\n\n# Calculate importance (absolute correlation)\nhazard_importance = np.abs(hazard_corr)\nvuln_importance = np.abs(vuln_corr)\n\n# Rank indicators\nhazard_rank = np.argsort(-hazard_importance) + 1\nvuln_rank = np.argsort(-vuln_importance) + 1\n\n# Top 3 hazard indicators\ntop3_hazard_idx = np.argsort(-hazard_importance)[:3]\ntop3_hazard = hazard_names[top3_hazard_idx]\ntop3_hazard_corr = hazard_corr[top3_hazard_idx]\n\n# Top 3 vulnerability indicators\ntop3_vuln_idx = np.argsort(-vuln_importance)[:3]\ntop3_vuln = vuln_names[top3_vuln_idx]\ntop3_vuln_corr = vuln_corr[top3_vuln_idx]\n\n# Summary statistics\nmean_hazard_corr = float(np.mean(hazard_importance))\nmean_vuln_corr = float(np.mean(vuln_importance))\nmax_hazard_corr = float(np.max(hazard_importance))\nmax_vuln_corr = float(np.max(vuln_importance))",
        "inputs": "data,covid_cases",
        "outputs": "hazard_names,hazard_corr,hazard_importance,vuln_names,vuln_corr,vuln_importance,top3_hazard,top3_hazard_corr,top3_vuln,top3_vuln_corr,mean_hazard_corr,mean_vuln_corr"
      },
      "inputs": [
        {"name": "data", "type": "dataframe", "link": 3},
        {"name": "covid_cases", "type": "array", "link": 4}
      ],
      "outputs": [
        {"name": "hazard_names", "type": "array", "links": [5]},
        {"name": "hazard_corr", "type": "array", "links": [6]},
        {"name": "hazard_importance", "type": "array", "links": [7]},
        {"name": "vuln_names", "type": "array", "links": [8]},
        {"name": "vuln_corr", "type": "array", "links": [9]},
        {"name": "vuln_importance", "type": "array", "links": [10]},
        {"name": "top3_hazard", "type": "array", "links": [11]},
        {"name": "top3_hazard_corr", "type": "array", "links": []},
        {"name": "top3_vuln", "type": "array", "links": [12]},
        {"name": "top3_vuln_corr", "type": "array", "links": []},
        {"name": "mean_hazard_corr", "type": "number", "links": [13]},
        {"name": "mean_vuln_corr", "type": "number", "links": [14]}
      ]
    },
    {
      "id": 6,
      "type": "io/output",
      "pos": [1100, 50],
      "size": [200, 60],
      "title": "Hazard Indicator Names",
      "properties": {
        "name": "hazard_indicator_names"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 5}
      ]
    },
    {
      "id": 7,
      "type": "io/output",
      "pos": [1100, 130],
      "size": [200, 60],
      "title": "Hazard Correlations",
      "properties": {
        "name": "hazard_correlations"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 6}
      ]
    },
    {
      "id": 8,
      "type": "io/output",
      "pos": [1100, 210],
      "size": [200, 60],
      "title": "Hazard Importance",
      "properties": {
        "name": "hazard_importance_scores"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 7}
      ]
    },
    {
      "id": 9,
      "type": "io/output",
      "pos": [1100, 290],
      "size": [200, 60],
      "title": "Vulnerability Indicator Names",
      "properties": {
        "name": "vulnerability_indicator_names"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 8}
      ]
    },
    {
      "id": 10,
      "type": "io/output",
      "pos": [1100, 370],
      "size": [200, 60],
      "title": "Vulnerability Correlations",
      "properties": {
        "name": "vulnerability_correlations"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 9}
      ]
    },
    {
      "id": 11,
      "type": "io/output",
      "pos": [1100, 450],
      "size": [200, 60],
      "title": "Vulnerability Importance",
      "properties": {
        "name": "vulnerability_importance_scores"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 10}
      ]
    },
    {
      "id": 12,
      "type": "io/output",
      "pos": [1350, 50],
      "size": [200, 60],
      "title": "Top 3 Hazard Indicators",
      "properties": {
        "name": "top3_hazard_indicators"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 11}
      ]
    },
    {
      "id": 13,
      "type": "io/output",
      "pos": [1350, 130],
      "size": [200, 60],
      "title": "Top 3 Vulnerability Indicators",
      "properties": {
        "name": "top3_vulnerability_indicators"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 12}
      ]
    },
    {
      "id": 14,
      "type": "io/output",
      "pos": [1350, 210],
      "size": [200, 60],
      "title": "Mean Hazard Correlation",
      "properties": {
        "name": "mean_hazard_correlation"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 13}
      ]
    },
    {
      "id": 15,
      "type": "io/output",
      "pos": [1350, 290],
      "size": [200, 60],
      "title": "Mean Vulnerability Correlation",
      "properties": {
        "name": "mean_vulnerability_correlation"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 14}
      ]
    },
    {
      "id": 16,
      "type": "viz/bar",
      "pos": [1350, 380],
      "size": [220, 120],
      "title": "Hazard Importance Chart",
      "properties": {
        "title": "Hazard Indicator Importance",
        "xlabel": "Indicator",
        "ylabel": "Importance (|correlation|)"
      },
      "inputs": [
        {"name": "X", "type": "array", "link": 15},
        {"name": "Y", "type": "array", "link": 16}
      ]
    }
  ],
  "links": [
    [1, 1, 0, 3, 0, "dataframe"],
    [2, 2, 0, 4, 0, "dataframe"],
    [3, 3, 0, 5, 0, "dataframe"],
    [4, 4, 0, 5, 1, "array"],
    [5, 5, 0, 6, 0, "array"],
    [6, 5, 1, 7, 0, "array"],
    [7, 5, 2, 8, 0, "array"],
    [8, 5, 3, 9, 0, "array"],
    [9, 5, 4, 10, 0, "array"],
    [10, 5, 5, 11, 0, "array"],
    [11, 5, 6, 12, 0, "array"],
    [12, 5, 8, 13, 0, "array"],
    [13, 5, 10, 14, 0, "number"],
    [14, 5, 11, 15, 0, "number"],
    [15, 5, 0, 16, 0, "array"],
    [16, 5, 2, 16, 1, "array"]
  ],
  "groups": [
    {
      "title": "Task 4: Sensitivity Analysis & Indicator Importance Ranking",
      "bounding": [30, 30, 1650, 550],
      "color": "#dda0dd"
    }
  ],
  "config": {},
  "extra": {
    "description": "Task 4: Analyze the sensitivity and importance of each indicator in predicting COVID-19 risk",
    "author": "AlgoNode",
    "version": "1.0",
    "methodology": {
      "correlation_analysis": "Pearson correlation between each normalized indicator and actual COVID cases",
      "importance_score": "Absolute value of correlation coefficient",
      "ranking": "Indicators ranked by importance score (higher = more important)"
    },
    "indicator_categories": {
      "hazard": "10 indicators measuring disaster hazard exposure",
      "vulnerability": "13 indicators measuring urban vulnerability"
    },
    "outputs": {
      "correlations": "Correlation coefficients for each indicator",
      "importance": "Absolute correlation as importance measure",
      "top3": "Top 3 most important indicators in each category",
      "mean_correlation": "Average importance across indicator categories"
    }
  }
}
