{
  "last_node_id": 15,
  "last_link_id": 18,
  "nodes": [
    {
      "id": 1,
      "type": "data/load_csv",
      "pos": [50, 100],
      "size": [220, 120],
      "title": "Load Data",
      "properties": {
        "path": "D:/algonode/user_project/Risk Assessment Based on the Coupling of Public Health Disaster Hazard and Urban Vulnerability/数据标准化.csv",
        "header": 0,
        "encoding": "utf-8",
        "output_format": "dataframe"
      },
      "outputs": [
        {"name": "data", "type": "dataframe", "links": [1]}
      ]
    },
    {
      "id": 2,
      "type": "data/filter_rows",
      "pos": [320, 100],
      "size": [200, 100],
      "title": "Filter Data Rows",
      "properties": {
        "condition": "index >= 3",
        "reset_index": true,
        "output_format": "dataframe"
      },
      "inputs": [
        {"name": "data", "type": "dataframe", "link": 1}
      ],
      "outputs": [
        {"name": "filtered", "type": "dataframe", "links": [2, 3]}
      ]
    },
    {
      "id": 3,
      "type": "data/select_column",
      "pos": [570, 50],
      "size": [200, 80],
      "title": "Select City Names",
      "properties": {
        "selector": "编号",
        "mode": "name",
        "as_array": true
      },
      "inputs": [
        {"name": "data", "type": "dataframe", "link": 2}
      ],
      "outputs": [
        {"name": "column", "type": "array", "links": [4]}
      ]
    },
    {
      "id": 4,
      "type": "data/weighted_score",
      "pos": [570, 200],
      "size": [280, 150],
      "title": "Calculate Hazard Score (U1)",
      "properties": {
        "indicators": "65岁及以上人口比例:P:1,贫困人口:P:1,人口密度:P:1,就业密度:P:1,国内游客到达人数:P:1,每万人公共汽车（和无轨电车）数量:P:1,公路客运交通量:P:1,PM2.5浓度:P:1,相对湿度:P:1,平均温度:N:1",
        "normalize": "minmax",
        "add_normalized_cols": false,
        "score_column": "U1_Hazard",
        "output_format": "dataframe"
      },
      "inputs": [
        {"name": "data", "type": "dataframe", "link": 3}
      ],
      "outputs": [
        {"name": "result", "type": "dataframe", "links": [5]}
      ]
    },
    {
      "id": 5,
      "type": "data/weighted_score",
      "pos": [900, 200],
      "size": [280, 150],
      "title": "Calculate Vulnerability Score (U2)",
      "properties": {
        "indicators": "居住密度:N:1,日常生活服务设施密度:P:1,交通设施密度:P:1,建成区绿化覆盖率:N:1,开放空间密度:N:1,失业率:P:1,人均收入:N:1,健康支出占GDP的百分比:N:1,每位居民年平均储蓄存款余额:N:1,应急物资储备支出占GDP的比例（%）（每万元）:N:1,每万人医生数量:N:1,每万人医院床位数:N:1,基本社会保险覆盖率:N:1",
        "normalize": "minmax",
        "add_normalized_cols": false,
        "score_column": "U2_Vulnerability",
        "output_format": "dataframe"
      },
      "inputs": [
        {"name": "data", "type": "dataframe", "link": 5}
      ],
      "outputs": [
        {"name": "result", "type": "dataframe", "links": [6, 7]}
      ]
    },
    {
      "id": 6,
      "type": "data/select_column",
      "pos": [1230, 150],
      "size": [200, 80],
      "title": "Extract U1",
      "properties": {
        "selector": "U1_Hazard",
        "mode": "name",
        "as_array": true
      },
      "inputs": [
        {"name": "data", "type": "dataframe", "link": 6}
      ],
      "outputs": [
        {"name": "column", "type": "array", "links": [8]}
      ]
    },
    {
      "id": 7,
      "type": "data/select_column",
      "pos": [1230, 260],
      "size": [200, 80],
      "title": "Extract U2",
      "properties": {
        "selector": "U2_Vulnerability",
        "mode": "name",
        "as_array": true
      },
      "inputs": [
        {"name": "data", "type": "dataframe", "link": 7}
      ],
      "outputs": [
        {"name": "column", "type": "array", "links": [9]}
      ]
    },
    {
      "id": 8,
      "type": "custom/python_script",
      "pos": [1480, 150],
      "size": [350, 350],
      "title": "Risk Assessment & Model Comparison",
      "properties": {
        "code": "import numpy as np\n\n# Normalize U1 and U2 to [0,1]\nu1_norm = (U1 - np.min(U1)) / (np.max(U1) - np.min(U1) + 1e-10)\nu2_norm = (U2 - np.min(U2)) / (np.max(U2) - np.min(U2) + 1e-10)\n\n# Coupling degree C = 2 * sqrt(U1*U2) / (U1+U2)\nC = 2 * np.sqrt(u1_norm * u2_norm) / (u1_norm + u2_norm + 1e-10)\n\n# Comprehensive index T = alpha*U1 + (1-alpha)*U2\nalpha = 0.5\nT = alpha * u1_norm + (1 - alpha) * u2_norm\n\n# Coupling coordination degree D = sqrt(C * T)\nD = np.sqrt(C * T)\n\n# Comprehensive Risk Index R = U1 * U2\nR = u1_norm * u2_norm\n\n# Traditional Risk Model (simple additive)\nR_trad = (u1_norm + u2_norm) / 2\n\n# Risk Level Classification\nrisk_level = []\nfor d, r in zip(D, R):\n    if d < 0.3:\n        level = 'I-Low'\n    elif d < 0.5:\n        level = 'II-Moderate' if r < 0.5 else 'III-Medium'\n    elif d < 0.7:\n        level = 'III-Medium' if r < 0.5 else 'IV-High'\n    else:\n        level = 'IV-High' if r < 0.7 else 'V-VeryHigh'\n    risk_level.append(level)\nrisk_level = np.array(risk_level)\n\n# Model comparison metrics\nvar_coupling = float(np.var(D))\nvar_trad = float(np.var(R_trad))\nadvantage = var_coupling / (var_trad + 1e-10)",
        "inputs": "U1,U2",
        "outputs": "C,T,D,R,R_trad,risk_level,var_coupling,var_trad,advantage"
      },
      "inputs": [
        {"name": "U1", "type": "array", "link": 8},
        {"name": "U2", "type": "array", "link": 9}
      ],
      "outputs": [
        {"name": "C", "type": "array", "links": [10]},
        {"name": "T", "type": "array", "links": [11]},
        {"name": "D", "type": "array", "links": [12]},
        {"name": "R", "type": "array", "links": [13]},
        {"name": "R_trad", "type": "array", "links": [14]},
        {"name": "risk_level", "type": "array", "links": [15]},
        {"name": "var_coupling", "type": "number", "links": [16]},
        {"name": "var_trad", "type": "number", "links": [17]},
        {"name": "advantage", "type": "number", "links": [18]}
      ]
    },
    {
      "id": 9,
      "type": "io/output",
      "pos": [1900, 50],
      "size": [180, 60],
      "title": "Coupling Degree C",
      "properties": {
        "name": "C_coupling_degree"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 10}
      ]
    },
    {
      "id": 10,
      "type": "io/output",
      "pos": [1900, 130],
      "size": [180, 60],
      "title": "Comprehensive Index T",
      "properties": {
        "name": "T_comprehensive_index"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 11}
      ]
    },
    {
      "id": 11,
      "type": "io/output",
      "pos": [1900, 210],
      "size": [180, 60],
      "title": "Coordination Degree D",
      "properties": {
        "name": "D_coordination_degree"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 12}
      ]
    },
    {
      "id": 12,
      "type": "io/output",
      "pos": [1900, 290],
      "size": [180, 60],
      "title": "Risk Index R",
      "properties": {
        "name": "R_risk_index"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 13}
      ]
    },
    {
      "id": 13,
      "type": "io/output",
      "pos": [1900, 370],
      "size": [180, 60],
      "title": "Risk Level",
      "properties": {
        "name": "risk_level"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 15}
      ]
    },
    {
      "id": 14,
      "type": "io/output",
      "pos": [1900, 450],
      "size": [180, 60],
      "title": "Model Advantage",
      "properties": {
        "name": "coupling_model_advantage"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 18}
      ]
    },
    {
      "id": 15,
      "type": "io/output",
      "pos": [820, 50],
      "size": [180, 60],
      "title": "City Names",
      "properties": {
        "name": "city_names"
      },
      "inputs": [
        {"name": "value", "type": "any", "link": 4}
      ]
    }
  ],
  "links": [
    [1, 1, 0, 2, 0, "dataframe"],
    [2, 2, 0, 3, 0, "dataframe"],
    [3, 2, 0, 4, 0, "dataframe"],
    [4, 3, 0, 15, 0, "array"],
    [5, 4, 0, 5, 0, "dataframe"],
    [6, 5, 0, 6, 0, "dataframe"],
    [7, 5, 0, 7, 0, "dataframe"],
    [8, 6, 0, 8, 0, "array"],
    [9, 7, 0, 8, 1, "array"],
    [10, 8, 0, 9, 0, "array"],
    [11, 8, 1, 10, 0, "array"],
    [12, 8, 2, 11, 0, "array"],
    [13, 8, 3, 12, 0, "array"],
    [14, 8, 4, 12, 0, "array"],
    [15, 8, 5, 13, 0, "array"],
    [16, 8, 6, 14, 0, "number"],
    [17, 8, 7, 14, 0, "number"],
    [18, 8, 8, 14, 0, "number"]
  ],
  "groups": [
    {
      "title": "Task 2: Coupling Coordination & Risk Level Classification",
      "bounding": [30, 30, 2150, 580],
      "color": "#f0e68c"
    }
  ],
  "config": {},
  "extra": {
    "description": "Task 2: Calculate coupling coordination degree, classify risk levels for 18 cities, and demonstrate model superiority",
    "author": "AlgoNode",
    "version": "2.0",
    "formulas": {
      "coupling_degree": "C = 2 * sqrt(U1 * U2) / (U1 + U2)",
      "comprehensive_index": "T = 0.5 * U1 + 0.5 * U2",
      "coordination_degree": "D = sqrt(C * T)",
      "risk_index": "R = U1 * U2",
      "traditional_risk": "R_trad = (U1 + U2) / 2",
      "model_advantage": "advantage = var(D) / var(R_trad)"
    },
    "risk_levels": {
      "I-Low": "D < 0.3",
      "II-Moderate": "0.3 <= D < 0.5, R < 0.5",
      "III-Medium": "0.3 <= D < 0.7",
      "IV-High": "0.5 <= D < 0.85",
      "V-VeryHigh": "D >= 0.7, R >= 0.7"
    }
  }
}
